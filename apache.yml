---
  - hosts: prod_servers
    tasks:
      - name: Installs apache web server
        apt: pkg=apache2 state=installed update_cache=true
      
      - name: Push default virtual host configuration 
        copy: src=/home/devlikeops/work/files/devlike-app  dest=/etc/apache2/sites-available/ mode=0640

      - name: Deactivates the default virtualhost
        command: ad2dissite default

      - name: Deactivates the default ssl virtualhost
        command: ad2dissite default-ssl

      - name: Activates our virtualhost
        command: a2ensite devlike-app
        notify:
           - restart apache      

    handlers:
      - name: restart apache    
        service: name=apache2 state=restarted